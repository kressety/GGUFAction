name: Model Quantization

on:
  workflow_dispatch:
    inputs:
      repo_id:
        description: 'Hugging Face repository ID (username/model_name)'
        required: true
        type: string

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
    - name: Install Python dependencies
      run: |
        pip install huggingface_hub modelscope torch --index-url https://download.pytorch.org/whl/cpu sentencepiece
    - name: Install C++ tools and build llama.cpp
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential git cmake
        git clone https://github.com/ggerganov/llama.cpp.git
        cd llama.cpp
        cmake -B build -DCMAKE_BUILD_TYPE=Release
        cmake --build build --config Release -j$(nproc)
    - name: Run Python script
      env:
        HF_API_KEY: ${{ secrets.HF_API_KEY }}
        MS_API_KEY: ${{ secrets.MS_API_KEY }}
        REPO_ID: ${{ inputs.repo_id }}
      run: python script.py
